# Техническая реализация Rusongs.org Website

Данный документ описывает архитектуру, компоненты и процессы, используемые в промо-сайте Rusongs.org. Сайт построен на Next.js 16 (App Router) и предназначен для публикации продуктовой документации, хранящейся в формате Markdown.

## 1. Архитектура и рендеринг

- **Фреймворк**: Next.js 16 с использованием App Router и строгого режима React.
- **Режим генерации**: все маршруты предрендерятся статически при сборке (`next build`). В типичном сценарии деплоя на Vercel страницы обслуживаются из CDN.
- **Вывод**: `next.config.ts` включает `output: "standalone"`, что даёт готовый к развёртыванию артефакт с Node.js сервером и минимальным набором зависимостей.
- **Шрифты**: встроенные Google Fonts (Geist Sans/MONO) подключаются через `next/font/google` и работают во время SSG без дополнительных запросов.

## 2. Структура проекта

```
.
├── app/                         # App Router: страницы, layout и глобальные стили
│   ├── layout.tsx               # Общий каркас, навигация и футер
│   ├── page.tsx                 # Главная страница (контент-тизер)
│   ├── overview/page.tsx        # Рендер overview.md
│   └── tech/page.tsx            # Рендер tech.md
├── docs/
│   ├── website/overview.md      # Описание продукта
│   ├── website/tech.md          # Технический стек
│   └── technical-implementation.md  # (текущий документ)
├── lib/markdown.ts              # Рендер Markdown → HTML
├── public/                      # Публичные ассеты
├── vercel.json                  # Настройки деплоя
├── package.json                 # Скрипты и зависимости
└── tsconfig.json                # Конфигурация TypeScript
```

## 3. Фронтенд-слой

### 3.1 App Router
- Каждая страница является серверным компонентом и получает данные во время сборки.
- Маршруты (`app/**/page.tsx`) экспортируют `metadata` для настройки `<title>` и `<meta>` тегов.
- 404 обрабатывается автоматически с помощью `/_not-found` (генерируется Next.js).

### 3.2 Layout и навигация
- `app/layout.tsx` задаёт верхний колонтитул, футер и глобальные классы.
- Навигация строится на массиве `navigation`, что упрощает добавление новых ссылок.
- Футер содержит ссылки на разделы документации и упоминание Vercel.

### 3.3 Главная страница
- `app/page.tsx` агрегирует ключевые тезисы из продуктового обзора:
  - Ценностное предложение.
  - Целевая аудитория и сегменты.
  - Ключевые функции.
  - CTA в разделы `overview` и `tech`.
- Контент оформлен utility-классами Tailwind 4 и использует CSS переменные для цветовой схемы.

## 4. Рендеринг Markdown

- Файл `lib/markdown.ts` отвечает за чтение и преобразование Markdown.
- Используемые плагины:
  - `remark-gfm` — поддержка GitHub Flavored Markdown (таблицы, чекбоксы).
  - `remark-slug` — генерация `id` для заголовков (для ссылок-якорей). Из-за несовместимости типов подключается через `slug as any`.
  - `remark-html` — преобразование AST в HTML-строку.
- `renderMarkdown` принимает относительный путь к файлу в `docs/` и возвращает HTML + заголовок верхнего уровня (используется при необходимости в будущем).
- Безопасность: контент предполагается доверенным (docs под контролем репозитория). Если потребуется защита от XSS, можно добавить `rehype-sanitize`.

## 5. Стилизация

- Глобальные стили (`app/globals.css`) используют Tailwind CSS v4 с директивой `@import "tailwindcss"`.
- Основные цвета, фон и типографика вынесены в CSS-переменные:
  - `--color-primary`, `--color-secondary`, `--color-background`, `--color-text-*`.
- Класс `.markdown` настраивает типографику для HTML, сгенерированного из Markdown: заголовки, списки, таблицы, блоки кода и цитаты.
- Для блоков кода используется тёмный фон и моноширинный шрифт Geist Mono.

## 6. Работа с контентом

- Исходные файлы хранятся в `docs/website`. Добавление нового раздела требует:
  1. Создать Markdown-файл в `docs/website`.
  2. Создать страницу в `app/<slug>/page.tsx` и вызвать `renderMarkdown("<path>")`.
  3. Добавить ссылку в верхнее меню (`navigation` в layout).
- Если нужны автоматические якорные ссылки, можно расширить UI (например, генерировать TOC) — для этого достаточно парсить HTML после рендеринга.

## 7. Сборка и деплой

- **ESLint**: `npm run lint` — строго без предупреждений (`--max-warnings=0`).
- **Production build**: `npm run build`, генерирует `.next` и выводит список маршрутов.
- **Старт production build**: `npm run start` (использует standalone-вывод).
- **Vercel**:
  - `vercel.json` фиксирует команды `install`, `build`, `dev`.
  - Регионы: `arn1`, `sfo1`, `gru1` — географическое покрытие.
  - Необходимые действия: подключить репозиторий, указать build command и output directory (`.next`).
  - Всё статично, поэтому переменные окружения не требуются.

## 8. Локальная разработка

1. `npm install`
2. `npm run dev`
3. Открыть http://localhost:3000

Рекомендуется включить опцию редактора для ESLint и TypeScript для быстрого обнаружения ошибок.

## 9. Качество и тестирование

- **Линтер**: ESLint (конфиг Next.js 16 + React 19). Проверяется во время CI и локально.
- **Сборка**: Next.js build — гарантирует валидность типов TypeScript и корректную генерацию страниц.
- **Будущий расширяемый набор**:
  - Визуальные снимки (Chromatic/Playwright) для проверки издания контента.
  - Проверка доступности (axe-core или встроенные плагины Next.js).
  - Интеграционные тесты с Playwright для проверки навигации.

## 10. Обновление зависимости и Tailwind v4

- Tailwind CSS 4 подключается через `@import "tailwindcss";`.
- Конфигурация `postcss.config.mjs` создаётся автоматически пакетом `@tailwindcss/postcss`.
- Для расширенных тем и плагинов (например, кастомной типографики) можно добавить `tailwind.config.ts` (по умолчанию не требуется).

## 11. Безопасность и производительность

- Статический вывод минимизирует риск SSR-багов.
- `poweredByHeader: false` скрывает заголовок `X-Powered-By`.
- Использование встроенных шрифтов через `next/font` снижает сторонние запросы.
- При добавлении динамического контента следует следить за корректной сериализацией (например, не передавать в клиентские компоненты недопустимые типы).

## 12. Дальнейшее развитие

- Добавить автоматическую генерацию оглавления (TOC) для длинных документов.
- Поддержка многопроектной документации (добавление конфигурации маршрутов через `generateStaticParams`).
- Интеграция с CMS (например, GitHub CMS или mdx) при росте количества страниц.
- Добавление тестов доступности и визуальных регрессов.
- Локализация: текущий контент на русском; при необходимости расширить до нескольких языков (Next.js i18n routing).

---

Документ может служить стартовой точкой для разработчиков, подключающихся к проекту, и для команды, обслуживающей инфраструктуру Rusongs.org. При изменениях в архитектуре файл следует обновлять, чтобы сохранить актуальность и единое понимание технической модели.*** End Patch
